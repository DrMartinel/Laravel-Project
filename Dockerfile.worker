FROM php:8.2-cli-alpine

# Install minimal required extensions for queue worker
RUN docker-php-ext-install pdo pdo_mysql

# Install composer with only production dependencies
COPY --from=composer:2 /usr/bin/composer /usr/bin/composer
COPY composer.* ./
RUN composer install --no-dev --no-scripts --no-autoloader

# Copy application
COPY . .
RUN composer dump-autoload --optimize

# Use non-root user
USER www-data

WORKDIR /var/www
